https://github.com/davidmrau/mixture-of-experts/blob/master/moe.py